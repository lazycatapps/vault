# app çš„å”¯ä¸€ id,ä¸Šæ¶åˆ°å•†åº—éœ€è¦ä¿è¯ä¸è¦å†²çª,å°½é‡ä½¿ç”¨å¼€å‘è€…è‡ªå·±çš„åŸŸåä½œä¸ºåç¼€.
package: cloud.lazycat.app.liu.vault
# app çš„ç‰ˆæœ¬
version: 1.21.0

name: Vault
keyword: vault, secrets, security, hashicorp
description: HashiCorp Vault å¯†é’¥ç®¡ç†ç³»ç»Ÿ

# è½¯ä»¶åç§°,ä¼šæ˜¾ç¤ºåœ¨å¯åŠ¨å™¨ä¹‹ç±»çš„åœ°æ–¹
locales:
  zh:
    name: Vault å¯†é’¥ç®¡ç†
    description: |
      ## HashiCorp Vault å¯†é’¥ç®¡ç†ç³»ç»Ÿ

      **å®˜æ–¹ç½‘ç«™ï¼š** https://www.vaultproject.io/
      **ä»“åº“åœ°å€ï¼š** https://github.com/lazycatapps/vault.git
      **å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼š** https://github.com/lazycatapps/vault/blob/main/QUICKSTART.md

      HashiCorp Vault æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¯†é’¥ç®¡ç†å·¥å…·ï¼Œç”¨äºå®‰å…¨åœ°å­˜å‚¨å’Œè®¿é—®å¯†é’¥ã€å¯†ç ã€è¯ä¹¦ã€API å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚Vault æä¾›äº†ç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®ä»»ä½•å¯†é’¥ï¼ŒåŒæ—¶æä¾›ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œè¯¦ç»†çš„å®¡è®¡æ—¥å¿—ã€‚

      æœ¬åº”ç”¨æä¾›äº†å®Œæ•´çš„ Vault æœåŠ¡å™¨ç¯å¢ƒï¼Œæ”¯æŒ Web UI å’Œ API è®¿é—®ï¼Œé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚

      ## è®¿é—®åœ°å€

      åº”ç”¨å®‰è£…åï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

      `https://vault.{box-name}.heiyu.space`

      ## ä¸»è¦åŠŸèƒ½

      - ğŸ” å®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€API å¯†é’¥ã€è¯ä¹¦ç­‰ï¼‰
      - ğŸ“ Key-Value å¯†é’¥å¼•æ“ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶
      - ğŸ”„ åŠ¨æ€å¯†é’¥ç”Ÿæˆï¼ˆæ•°æ®åº“ã€äº‘æœåŠ¡ç­‰ï¼‰
      - ğŸ”‘ å¤šç§èº«ä»½éªŒè¯æ–¹æ³•ï¼ˆTokenã€LDAPã€GitHub ç­‰ï¼‰
      - ğŸ“Š è¯¦ç»†çš„å®¡è®¡æ—¥å¿—è®°å½•
      - ğŸŒ RESTful API å’Œå‘½ä»¤è¡Œå·¥å…·
      - ğŸ¨ ç›´è§‚çš„ Web ç”¨æˆ·ç•Œé¢
      - ğŸ”’ æ•°æ®åŠ å¯†å’Œè®¿é—®æ§åˆ¶ç­–ç•¥

      ## é¦–æ¬¡ä½¿ç”¨è¯´æ˜ï¼ˆé‡è¦ï¼‰

      **æ³¨æ„ï¼šVault åœ¨é¦–æ¬¡å¯åŠ¨æ—¶éœ€è¦è¿›è¡Œåˆå§‹åŒ–å’Œè§£å°æ“ä½œï¼Œè¿™æ˜¯ Vault å®‰å…¨æœºåˆ¶çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼**

      ### é€šè¿‡ Web UI åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

      1. è®¿é—®åº”ç”¨çš„ Web ç•Œé¢
      2. ç‚¹å‡» "Initialize" æŒ‰é’®
      3. é…ç½®å¯†é’¥åˆ†ç‰‡æ•°é‡å’Œè§£å°é˜ˆå€¼
      4. ç‚¹å‡» "Initialize" å®Œæˆåˆå§‹åŒ–
      5. **é‡è¦ï¼šç«‹å³ä¸‹è½½æˆ–å¤åˆ¶ä¿å­˜æ‰€æœ‰ Unseal Keys å’Œ Root Tokenï¼è¿™äº›ä¿¡æ¯ä¸€æ—¦ä¸¢å¤±æ— æ³•æ¢å¤ï¼**
      6. ä½¿ç”¨æ‰€éœ€æ•°é‡çš„ Unseal Keys ä¾æ¬¡è§£å° Vault
      7. ä½¿ç”¨ Root Token ç™»å½•ç³»ç»Ÿ

      ## ä½¿ç”¨æ–¹æ³•

      ### Web UI æ“ä½œ

      1. ä½¿ç”¨ Root Token æˆ–å…¶ä»–è®¤è¯æ–¹å¼ç™»å½•
      2. å¯ç”¨éœ€è¦çš„å¯†é’¥å¼•æ“ï¼ˆå¦‚ KV v2ï¼‰
      3. åˆ›å»ºå’Œç®¡ç†å¯†é’¥
      4. é…ç½®è®¿é—®ç­–ç•¥å’Œè®¤è¯æ–¹æ³•
      5. æŸ¥çœ‹å®¡è®¡æ—¥å¿—

      ## å®‰å…¨æ³¨æ„äº‹é¡¹

      - ğŸ”‘ **Unseal Keys ç®¡ç†**ï¼šè¯·å°† Unseal Keys åˆ†æ•£ä¿ç®¡åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œéœ€è¦è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼æ•°é‡æ‰èƒ½è§£å° Vault
      - ğŸ« **Root Token ä¿æŠ¤**ï¼šRoot Token å…·æœ‰å®Œå…¨æƒé™ï¼Œè¯·å¦¥å–„ä¿ç®¡å¹¶è€ƒè™‘ä½¿ç”¨å…¶ä»–è®¤è¯æ–¹æ³•æ›¿ä»£æ—¥å¸¸ä½¿ç”¨
      - ğŸ”’ **ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼šå½“å‰é…ç½®ç¦ç”¨äº† TLSï¼Œä»…é€‚ç”¨äºå¼€å‘æµ‹è¯•ã€‚ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…å¯ç”¨ TLS åŠ å¯†
      - ğŸ’¾ **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ Vault æ•°æ®å’Œé…ç½®ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šä¸¢å¤±
      - ğŸ“ **å®¡è®¡æ—¥å¿—**ï¼šå»ºè®®å¯ç”¨å®¡è®¡æ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸º

      ## å¸¸è§é—®é¢˜

      ### Vault å¤„äº sealed çŠ¶æ€

      Vault æ¯æ¬¡é‡å¯åä¼šè‡ªåŠ¨è¿›å…¥ sealedï¼ˆå¯†å°ï¼‰çŠ¶æ€ï¼Œéœ€è¦é‡æ–°è§£å°ã€‚è¯·é€šè¿‡ Web UI è®¿é—®ç•Œé¢ï¼Œè¾“å…¥æ‰€éœ€æ•°é‡çš„ Unseal Keys è¿›è¡Œè§£å°ã€‚

      ### å¿˜è®° Root Token

      å¦‚æœå¿˜è®° Root Tokenï¼Œå¯ä»¥ä½¿ç”¨ Unseal Keys ç”Ÿæˆæ–°çš„ Root Tokenã€‚å…·ä½“æ“ä½œè¯·å‚è€ƒ Vault å®˜æ–¹æ–‡æ¡£ã€‚

  en:
    name: Vault
    description: |
      ## HashiCorp Vault Secrets Management System

      **Official Website:** https://www.vaultproject.io/
      **Repository:** https://github.com/lazycatapps/vault.git
      **Quick Start Guide:** https://github.com/lazycatapps/vault/blob/main/QUICKSTART.md

      HashiCorp Vault is a powerful secrets management tool for securely storing and accessing secrets, passwords, certificates, API keys, and other sensitive information. Vault provides a unified interface to access any secret while providing strict access control and detailed audit logs.

      This application provides a complete Vault server environment, supporting Web UI and API access, suitable for development and testing environments.

      ## Access URL

      After installation, the application can be accessed via:

      `https://vault.{box-name}.heiyu.space`

      ## Main Features

      - ğŸ” Securely store sensitive information (passwords, API keys, certificates, etc.)
      - ğŸ“ Key-Value secrets engine with version control
      - ğŸ”„ Dynamic secrets generation (databases, cloud services, etc.)
      - ğŸ”‘ Multiple authentication methods (Token, LDAP, GitHub, etc.)
      - ğŸ“Š Detailed audit logging
      - ğŸŒ RESTful API and command-line tools
      - ğŸ¨ Intuitive Web user interface
      - ğŸ”’ Data encryption and access control policies

      ## First-time Usage Instructions (Important)

      **Note: Vault requires initialization and unsealing operations on first startup. This is an important part of Vault's security mechanism!**

      ### Initialize via Web UI (Recommended)

      1. Access the application's Web interface
      2. Click the "Initialize" button
      3. Configure the number of key shares and unseal threshold
      4. Click "Initialize" to complete initialization
      5. **Important: Immediately download or copy all Unseal Keys and Root Token! This information cannot be recovered if lost!**
      6. Use the required number of Unseal Keys to unseal Vault sequentially
      7. Login to the system using the Root Token

      ## Usage Instructions

      ### Web UI Operations

      1. Login using Root Token or other authentication methods
      2. Enable required secrets engines (e.g., KV v2)
      3. Create and manage secrets
      4. Configure access policies and authentication methods
      5. View audit logs

      ## Security Considerations

      - ğŸ”‘ **Unseal Keys Management**: Store Unseal Keys separately in secure locations. The configured threshold number of Keys is required to unseal Vault
      - ğŸ« **Root Token Protection**: Root Token has full privileges. Keep it secure and consider using other authentication methods for daily use
      - ğŸ”’ **Production Configuration**: Current configuration disables TLS and is only suitable for development and testing. Production environments must enable TLS encryption
      - ğŸ’¾ **Data Backup**: Regularly backup Vault data and configuration to ensure secrets are not lost
      - ğŸ“ **Audit Logs**: It's recommended to enable audit logging to record all access activities

      ## Common Issues

      ### Vault is in sealed state

      Vault automatically enters sealed state after each restart and needs to be unsealed. Please access the Web UI and enter the required number of Unseal Keys to unseal.

      ### Forgot Root Token

      If you forget the Root Token, you can generate a new Root Token using Unseal Keys. Please refer to the official Vault documentation for specific instructions.

# è½¯ä»¶æœ¬èº«çš„ license
license: https://github.com/hashicorp/vault?tab=License-1-ov-file#readme

# è½¯ä»¶çš„ä¸»é¡µ,ä¼šåœ¨å•†åº—ç­‰åœ°æ–¹ä½“ç°
homepage: https://github.com/hashicorp/vault

# lpk çš„ä½œè€…,ä¼šåœ¨å•†åº—ç­‰åœ°æ–¹ä½“ç°
author: liu

# application ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„ container è¿è¡Œï¼Œå¯¹åº”çš„ service åç§°ä¸ºå›ºå®šçš„`app`ï¼Œ å…¶ä»– service å¯ä»¥é€šè¿‡æ­¤åç§°ä¸ app è¿›è¡Œé€šè®¯
application:
  #æ˜¯å¦å­˜åœ¨åå°ä»»åŠ¡ï¼Œ è‹¥å­˜åœ¨åˆ™ç³»ç»Ÿä¸ä¼šå¯¹æ­¤ app è¿›è¡Œä¸»åŠ¨ä¼‘çœ ç­‰æ“ä½œ
  background_task: true

  # æœŸæœ›çš„ app åŸŸåï¼Œå¦‚æœç³»ç»Ÿä¸­å·²ç»æœ‰å¯¹åº”åŸŸååˆ™ä¼šæç¤ºç”¨æˆ·é€‰æ‹©å…¶ä»–åŸŸåã€‚ æœ€ç»ˆ app åˆ†é…åˆ°çš„åŸŸåä»¥/lzcapp/run/app.subdomain ä¸ºå‡†
  subdomain: vault

  routes:
    - /=http://vault:8200

  depends_on:
    - vault

  # æ˜¯å¦å¯ç”¨å¤šå®ä¾‹
  multi_instance: false

services:
  vault:
    # lzc-cli appstore copy-image hashicorp/vault:latest
    image: registry.lazycat.cloud/liu/hashicorp/vault:e39347ced948f85b
    environment:
      - |-
        VAULT_LOCAL_CONFIG={
          "storage": {
            "file": {
              "path": "/vault/file"
            }
          },
          "listener": [
            {
              "tcp": {
                "address": "0.0.0.0:8200",
                "tls_disable": true
              }
            }
          ],
          "default_lease_ttl": "168h",
          "max_lease_ttl": "720h",
          "ui": true,
          "disable_mlock": true
        }

    # IPC_LOCK capability is required for memory locking
    # This prevents sensitive values from being swapped to disk
    # Note: Currently disabled via disable_mlock for compatibility
    cap_add:
      - IPC_LOCK
    command: server
    binds:
      - /lzcapp/var/file:/vault/file
      - /lzcapp/var/logs:/vault/logs
    health_check:
      test:
        - CMD-SHELL
        - 'wget --spider --proxy=off http://127.0.0.1:8200'
      start_period: 60s
unsupported_platforms:
  - ios
  - android
  - tvos
